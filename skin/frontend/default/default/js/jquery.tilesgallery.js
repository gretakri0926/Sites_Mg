function _jquerytg_getNatural(a){var b=new Image;return b.src=a.src,{width:b.width,height:b.height}}function _jquerytg_imgLoaded(a,b,c,d){var e=jQuery(a).data("k"),f=b["jquery-tg"+e];c[this.src]={width:this.width,height:this.height,ratio:this.width/this.height};if(++f.loadedImages==f.totalImages){var g=this;jQuery(".preload").remove(),b["jquery-tg"+e].source.find(".loading").remove(),_jquerytg_doTile(b,e,d)}}function _jquerytg_addCaptions(a,b,c){var d=a["jquery-tg"+b].source;d.find("img").each(function(){var a=jQuery(this).attr("alt");jQuery(this).removeAttr("alt");if(a!=undefined&&jQuery.trim(a).length>0){var b=jQuery("<p class='caption' />"),d=jQuery("<span class='text' />");d.text(a),b.css({bottom:0,left:0,zIndex:2,position:"absolute",width:"100%"}),b.append(d),c.captionOnMouseOver&&(b.hide(),jQuery(this).parents(".tiles-content").hover(function(){b.slideDown()},function(){b.slideUp()})),jQuery(this).parents(".tiles-content").append(b)}})}function _jquerytg_doTile(a,b,c){var d=a["jquery-tg"+b].source;d.find(".jquery-tiles").remove();var e=jQuery("<div class='jquery-tiles' />");d.empty().append(e);var f=c.width,g=c.height,h=jQuery("<div class='tiles-item' />");h.width(f-c.margin),h.height(g-c.margin),e.append(h);var i=0;while(i<a["jquery-tg"+b].totalImages-1){var j=e.find(".tiles-item:empty"),k=0,l=0;for(var m=0;m<j.size();m++){var n=j.eq(m),o=n.width()*n.height();o>l&&(l=o,k=m)}var p=j.eq(k),q=p.width(),r=p.height(),s=h1=0,t=h2=0;if(r>q){s=q,t=q;var u=r*.5;h1=Math.round(r/2+(Math.random()*u-u/2)),h2=r-h1}else{h1=r,h2=r;var u=q*.5;s=Math.round(q/2+(Math.random()*u-u/2)),t=q-s}var v=jQuery("<div class='tiles-item' />");v.width(s),v.height(h1),v.css({"float":"left",overflow:"hidden"});var w=jQuery("<div class='tiles-item' />");w.width(t),w.height(h2),w.css({"float":"left",overflow:"hidden"}),p.append(v).append(w),i++}d.find(".tiles-item").css({position:"relative"}),d.find(".tiles-item:empty").each(function(d,e){jQuery(e).addClass("tiles-content"),jQuery(e).addClass(c.contentClass).css({marginRight:c.margin,marginBottom:c.margin}),jQuery(e).width(jQuery(e).width()-c.margin),jQuery(e).height(jQuery(e).height()-c.margin);var f=jQuery(e).width(),g=jQuery(e).height(),h=a["jquery-tg"+b].lastItem++,i=a["jquery-tg"+b].tilesItems.eq(h%a["jquery-tg"+b].totalImages).clone(!0,!0);i.appendTo(jQuery(e));var j=i.find("img");if(j.size()>0){j.removeAttr("style");var k=_jquerytg_getNatural(j.get(0)),l=k.width,m=k.height,n=l/m,o=f/g;if(n<=o){var p=Math.round(f/n),q=Math.round((p-g)/-2);j.css({height:p,width:f,marginTop:q})}else{var r=Math.round(g*n),s=Math.round((r-f)/-2);j.css({height:g,width:r,marginLeft:s})}j.css({position:"absolute",zIndex:1,top:0,left:0}),j.show()}}),c.caption&&_jquerytg_addCaptions(a,b,c),jQuery.isFunction(c.callback)&&c.callback.call(d)}(function(a){a.shuffle=function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},a.fn.tilesGallery=function(b){var c={margin:3,caption:!0,captionOnMouseOver:!0},b=a.extend(c,b),d={},e={},f=0;return this.each(function(){var c=++f+Math.random();d["jquery-tg"+c]={},d["jquery-tg"+c].totalImages=a("img",this).size(),d["jquery-tg"+c].loadedImages=0,d["jquery-tg"+c].currentPage=0,d["jquery-tg"+c].lastItem=0,d["jquery-tg"+c].source=a(this),d["jquery-tg"+c].tilesItems=d["jquery-tg"+c].source.children(),d["jquery-tg"+c].tilesItems=a.shuffle(d["jquery-tg"+c].tilesItems),a(this).css({position:"relative",overflow:"hidden",paddingTop:b.margin,paddingLeft:b.margin}),b.width&&a(this).css({width:b.width-(a.browser.msie?0:b.margin)}),b.height&&a(this).css({height:b.height-(a.browser.msie?0:b.margin)}),a(this).append("<span class='loading'  />"),a(this).find(".loading").css({position:"absolute",top:b.height/2,left:"50%"}),a(".preload").remove();var g=this;setTimeout(function(){var f=a("img",g);for(var h=0;h<f.size();h++){var i=new Image;a(i).attr("data-k",c),i.onload=function(){_jquerytg_imgLoaded(this,d,e,b)},i.onerror=function(){d["jquery-tg"+c].loadedImages++},a("body").append(i),a(i).addClass("preload").hide(),i.src=f.eq(h).attr("src")}},500)})}})(jQuery)